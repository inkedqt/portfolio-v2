{%- assign rows = include.items | default: include.rows -%}
{%- if rows == nil or rows == empty -%}
  {%- assign rows = site.data.pg | default: site.data.thm | default: site.data.proving_grounds -%}
{%- endif -%}

<h2 class="section-heading">{{ include.title }}</h2>
<p class="private-note">Loaded rows: {{ rows | size }}</p>

<div class="htb-table-wrapper">
  <table class="htb-table">
    <colgroup>
      <col class="col-machine">
      <col class="col-difficulty">
      <col class="col-status">
      <col class="col-proof">
      <col class="col-writeup">
      <col class="col-summary">
    </colgroup>

    <thead>
      <tr>
        <th>Box</th>
        <th>Difficulty</th>
        <th>Status</th>
        <th>Proof</th>
        <th>Link</th>
        <th>Notes</th>
      </tr>
    </thead>

    <tbody>
      {%- for m in rows -%}
      <tr>
        <td>{{ m.name | default: m.box | default: m.machine }}</td>
        <td>{{ m.difficulty | default: "—" }}</td>
        <td>{{ m.status | default: "—" }}</td>

        <td>
          {%- assign proof_src = m.proof_img | default: m.proof | default: m.image -%}
          {%- if proof_src -%}
            <img class="proof-img" src="{{ proof_src }}" alt="Proof for {{ m.name | default: m.box | default: m.machine }}" />
          {%- else -%}
            —
          {%- endif -%}
        </td>

        <td>
          {%- assign link = m.writeup_url | default: m.url | default: m.link -%}
          {%- if link and link != "" -%}
            <a class="writeup-link" href="{{ link }}">View</a>
          {%- else -%}
            —
          {%- endif -%}
        </td>

        <td class="summary-cell">
          {%- assign note = m.summary | default: m.blurb | default: m.notes -%}
          {%- if note and note != "" -%}
            <details class="summary-toggle">
              <summary>View notes ▶</summary>
              <div class="summary-content">{{ note }}</div>
            </details>
          {%- else -%}
            —
          {%- endif -%}
        </td>
      </tr>
      {%- endfor -%}
    </tbody>
  </table>
</div>
