<div class="htb-table-wrapper">
  <table class="htb-table">
    <colgroup>
      <col class="col-machine">
      <col class="col-difficulty">
      <col class="col-status">
      <col class="col-proof">
      <col class="col-writeup">
      <col class="col-summary">
    </colgroup>

    <thead>
      <tr>
        <th>Machine</th>
        <th>Difficulty</th>
        <th>Status</th>
        <th>Proof</th>
        <th>Writeup</th>
        <th>Summary</th>
      </tr>
    </thead>

    <tbody>
      {%- for m in site.data.retired -%}
      <tr>
        <td>{{ m.name | default: m.machine }}</td>
        <td>{{ m.difficulty }}</td>
        <td>{{ m.status | default: "✅ Done" }}</td>

        {%- assign proof_src = m.proof
          | default: m.proof_img
          | default: m.proof_url
          | default: m.image
          | default: m.proofsrc -%}
        <td>
          {%- if proof_src -%}
            <img class="proof-img"
                 src="{{ proof_src }}"
                 alt="Proof for {{ m.name | default: m.machine }}" />
          {%- else -%}
            —
          {%- endif -%}
        </td>

        {%- assign wu = m.writeup_html
          | default: m.writeup
          | default: m.link
          | default: m.url
          | default: m.writeup_url -%}
        <td>
          {%- if wu -%}
            {%- if wu contains '<a ' -%}
              {{ wu }}
            {%- else -%}
              <a class="writeup-link" href="{{ wu }}">View</a>
            {%- endif -%}
          {%- else -%}
            —
          {%- endif -%}
        </td>

        <td class="summary-cell">
          {%- if m.summary and m.summary != "" -%}
            <details class="summary-toggle">
              <summary>View chain ▶</summary>
              <div class="summary-content">
                {{ m.summary }}
              </div>
            </details>
          {%- else -%}
            —
          {%- endif -%}
        </td>

      </tr>
      {%- endfor -%}
    </tbody>
  </table>

  {% include table-tally.html items=site.data.retired title="Retired tally" %}
</div>
